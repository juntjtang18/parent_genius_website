<div th:fragment="navbar">
  <nav class="navbar navbar-expand-lg gp-navbar fixed-top">
    <div class="container-xxl d-flex align-items-center">

      <!-- Brand -->
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <img th:src="@{/images/GenParent-Logo.png}" alt="GenParenting Logo" class="gp-logo">
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler gp-toggler" type="button"
              data-bs-toggle="collapse" data-bs-target="#gpNavbar"
              aria-controls="gpNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Main nav -->
      <div class="collapse navbar-collapse" id="gpNavbar">

        <!-- Center menu -->
        <ul class="navbar-nav mx-auto gp-menu">
          <li class="nav-item">
            <a class="nav-link" href="/vision" th:text="#{navbar_aboutus}">About Us</a>
          </li>

          <!-- Segments (renamed from Functions) -->
          <li class="nav-item dropdown" id="segmentsDropdown">
            <a class="nav-link dropdown-toggle" href="/segments" id="segmentsDDLink" role="button"
               data-bs-toggle="dropdown" aria-expanded="false"
               th:text="#{navbar_segments}">Segments</a>
            <!-- STYLE ONLY: add gp-cta-menu; add gp-cta-item to each link -->
            <ul class="dropdown-menu gp-cta-menu" aria-labelledby="segmentsDDLink">
              <li><a class="dropdown-item gp-cta-item" th:href="@{/functions(function=1)}" th:text="#{navbar_seg1}">Emotional Development</a></li>
              <li><a class="dropdown-item gp-cta-item" th:href="@{/functions(function=2)}" th:text="#{navbar_seg2}">School & Social Life</a></li>
              <li><a class="dropdown-item gp-cta-item" th:href="@{/functions(function=3)}" th:text="#{navbar_seg3}">Growth & Milestones</a></li>
              <li><a class="dropdown-item gp-cta-item" th:href="@{/functions(function=4)}" th:text="#{navbar_seg4}">Parenting Resources</a></li>
              <li><a class="dropdown-item gp-cta-item" th:href="@{/functions(function=5)}" th:text="#{navbar_seg5}">Child Experts</a></li>
            </ul>
          </li>

          <!-- FAQ -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="faqDropdown" role="button" data-bs-toggle="dropdown"
               aria-expanded="false" th:text="#{navbar_faq}">FAQ</a>
            <!-- STYLE ONLY -->
            <ul class="dropdown-menu gp-cta-menu" aria-labelledby="faqDropdown">
              <li><a class="dropdown-item gp-cta-item" href="/faq" th:text="#{navbar_faq.caption1}">Parents</a></li>
              <li><a class="dropdown-item gp-cta-item" href="/feedback" th:text="#{navbar_faq.caption2}">Feedback</a></li>
            </ul>
          </li>

          <!-- Community -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="communityDropdown" role="button"
               data-bs-toggle="dropdown" aria-expanded="false" th:text="#{navbar.caption3}">Community</a>
            <!-- STYLE ONLY -->
            <ul class="dropdown-menu gp-cta-menu" aria-labelledby="communityDropdown">
              <li><a class="dropdown-item gp-cta-item" href="/posts" th:text="#{navbar.caption5}">Connect</a></li>
              <li><a class="dropdown-item gp-cta-item" href="/join-us" th:text="#{navbar.caption6}">Join Us</a></li>
            </ul>
          </li>

          <!-- Divider shown on desktop like the mock -->
          <li class="nav-item d-none d-lg-flex align-items-center">
            <span class="gp-divider" role="separator" aria-hidden="true"></span>
          </li>

          <!-- Language selector (globe icon) -->
          <li class="nav-item dropdown">
            <a class="nav-link d-flex align-items-center" href="#" id="languageDropdown"
               role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Language">
              <i class="fas fa-globe"></i>
            </a>
            <ul class="dropdown-menu" aria-labelledby="languageDropdown" id="languageList"></ul>
          </li>
        </ul>

        <!-- Right side: Login / User -->
        <ul class="navbar-nav ms-lg-2 align-items-center gp-right">
          <li class="nav-item" th:unless="${auth}">
            <a class="nav-link" href="/signin" th:text="#{navbar.caption8}">Login</a>
          </li>
          <li class="nav-item dropdown" th:if="${auth}">
			<a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown"
			   role="button" data-bs-toggle="dropdown" aria-expanded="false">
			  <i class="fas fa-user-circle gp-avatar"></i>
			  <span th:text="${#strings.substring(auth.name, 0, 5)}"></span>
			</a>

            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="/profile" th:text="#{navbar.profile}">Profile</a></li>
              <li><a class="dropdown-item" href="/logout" th:text="#{navbar_logout}">Sign Out</a></li>
            </ul>
          </li>

          <!-- Admin (unchanged, still available for EDITOR/ADMIN) -->
          <li class="nav-item dropdown"
              th:if="${auth != null && #authorization.expression('hasAnyRole(''EDITOR'', ''ADMIN'')')}">
            <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button"
               data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-user-shield me-1"></i><span th:text="#{navbar.caption6.1}">Admin</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminDropdown">
              <li><a class="dropdown-item" th:href="@{/course-list}"><i class="fas fa-chalkboard-teacher me-2"></i><span th:text="#{navbar.admin.courses}">Courses</span></a></li>
              <li><a class="dropdown-item" th:href="@{/topics}"><i class="fas fa-lightbulb me-2"></i><span>Topics</span></a></li>
              <li><a class="dropdown-item" th:href="@{/tips}"><i class="fas fa-star me-2"></i><span>Tips</span></a></li>
              <li><a class="dropdown-item" href="#" id="clearCacheLink"><i class="fas fa-sync-alt me-2"></i><span>Clear Segment Article Cache</span></a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Icons -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap">

  <!-- Styles to match the mock -->
  <style>
.gp-navbar {
  --gp-navbar-pad: 0.5rem; /* default (mobile) */
  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
  padding-top: var(--gp-navbar-pad);
  padding-bottom: var(--gp-navbar-pad);
}

@media (min-width: 768px) {
  .gp-navbar { --gp-navbar-pad: 0.75rem; }
}
@media (min-width: 1200px) {
  .gp-navbar { --gp-navbar-pad: 1.5rem; }
}

.gp-logo { height: 32px; width: auto; }

/* Poppins Medium 18pt for menu items */
.gp-menu .nav-link,
.gp-right .nav-link {
  font-family: 'Poppins', sans-serif;
  font-weight: 500;
  font-size: 18px;
  color: #eaf1ff !important;
  padding: .5rem .9rem;
}
.gp-menu .nav-link:hover, 
.gp-right .nav-link:hover { 
  color: #ffffff !important; 
  text-decoration: underline; 
}

.gp-divider {
  display: inline-block; width: 1px; height: 22px; 
  background: rgba(255,255,255,.45); margin: 0 .4rem;
}
.gp-avatar { font-size: 1.4rem; margin-right: .4rem; }
.gp-toggler { border: 1px solid rgba(255,255,255,.6); }
.gp-toggler .navbar-toggler-icon { filter: invert(1) brightness(2); }

.navbar .dropdown-menu { border-radius: .75rem; }
@media (max-width: 991.98px) {
  .gp-divider { display: none !important; }
  .gp-menu { padding-top: .5rem; }
}

.gp-brand-strong { font-weight: 700; color: #fff; letter-spacing: .2px; font-size: 1.35rem; }
.gp-brand-light  { font-weight: 300; color: #fff; letter-spacing: .2px; font-size: 1.35rem; }

.gp-navbar .navbar-nav { align-items: center; }

/* ===== Card-style dropdown to match mock (style only) ===== */
.gp-cta-menu {
  --gp-card-radius: 14px;
  --gp-card-shadow: 0 10px 22px rgba(0,0,0,.12);
  --gp-text-muted: #5b667a;
  --gp-text-hover: #2563eb;

  min-width: 320px;
  padding: 18px 22px;
  border: none;
  border-radius: var(--gp-card-radius);
  box-shadow: var(--gp-card-shadow);
  background: #fff;
}
.gp-cta-item {
  display: block;
  padding: 8px 6px;
  font-family: 'Poppins', sans-serif;
  font-weight: 500;
  font-size: 18px;
  color: var(--gp-text-muted);
  white-space: normal;
  line-height: 1.35;
  border-radius: 8px;
}
.gp-cta-item:hover,
.gp-cta-item:focus {
  color: var(--gp-text-hover);
  text-decoration: underline;
  background: transparent;
}
.gp-cta-item.active,
.gp-cta-item:active {
  background: transparent;
  color: var(--gp-text-hover);
  text-decoration: underline;
}
  </style>

  <!-- JS keeps your dynamic language list and cache clearing -->
  <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const languageList = document.getElementById('languageList');
      const dropdown = document.getElementById('languageDropdown');
      if (dropdown && languageList) {
        dropdown.addEventListener('shown.bs.dropdown', function () {
          if (languageList.children.length === 0) {
            fetch('/api/languages')
              .then(r => r.ok ? r.json() : Promise.reject('Failed to load languages'))
              .then(data => {
                for (const [code, name] of Object.entries(data)) {
                  const li = document.createElement('li');
                  const a = document.createElement('a');
                  a.className = 'dropdown-item';
                  const url = new URL(window.location.href);
                  url.searchParams.set('lang', code);
                  a.href = url.toString();
                  a.textContent = name;
                  li.appendChild(a);
                  languageList.appendChild(li);
                }
              })
              .catch(err => console.error('Error fetching languages:', err));
          }
        });
      }

      const clearCacheLink = document.getElementById('clearCacheLink');
      if (clearCacheLink) {
        clearCacheLink.addEventListener('click', function (e) {
          e.preventDefault();
          fetch('/api/v1/admin/cache/clear-functions', { method: 'POST' })
            .then(res => res.ok ? alert('Segment article cache cleared!') :
                                  alert('Failed to clear cache (permission required).'))
            .catch(() => alert('An error occurred while clearing the cache.'));
        });
      }
    });
  </script>
</div>
